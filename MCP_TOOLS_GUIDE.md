# MCP å·¥å…·ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

Aika DBA ç³»çµ±é€šé Model Context Protocol (MCP) æä¾›è±å¯Œçš„è³‡æ–™åº«æŸ¥è©¢å’Œåˆ†æå·¥å…·ï¼Œè®“ LLM å¯ä»¥å®‰å…¨æœ‰æ•ˆåœ°è¨ªå•å’Œåˆ†æè³‡æ–™åº«å…§å®¹ã€‚

## MCP å·¥å…·ç¸½è¦½

### ğŸ”§ è³‡æ–™åº«æ“ä½œå·¥å…·

#### `database_get_table_schema`
ç²å–ç‰¹å®šè³‡æ–™è¡¨çš„æ‰€æœ‰è³‡è¨Šï¼ŒåŒ…æ‹¬ schemaã€constraintsã€indexes å’Œæ¨£æœ¬æ•¸æ“šã€‚

**åƒæ•¸ï¼š**
- `table_name` (string, required): è³‡æ–™è¡¨åç¨±

**å›å‚³ï¼š**
```json
{
  "table_name": "users",
  "schema": {...},
  "constraints": {...},
  "indexes": [...],
  "samples": [...],
  "stats": {...}
}
```

#### `database_execute_sql_query`
åŸ·è¡Œè‡ªå®šç¾© SQL æŸ¥è©¢ä¸¦è¿”å›çµæœã€‚

**åƒæ•¸ï¼š**
- `query` (string, required): è¦åŸ·è¡Œçš„ SQL æŸ¥è©¢
- `max_rows` (integer, optional): æœ€å¤§è¿”å›è¡Œæ•¸ï¼Œé è¨­ 100

**å›å‚³ï¼š**
```json
{
  "query": "SELECT * FROM users LIMIT 10",
  "columns": ["id", "name", "email"],
  "rows": [...],
  "row_count": 10,
  "truncated": false
}
```

#### `database_get_table_samples`
ç²å–ç‰¹å®šè³‡æ–™è¡¨çš„æ›´å¤šæ¨£æœ¬æ•¸æ“šã€‚

**åƒæ•¸ï¼š**
- `table_name` (string, required): è³‡æ–™è¡¨åç¨±
- `limit` (integer, optional): æ¨£æœ¬æ•¸é‡ï¼Œé è¨­ 50
- `offset` (integer, optional): åç§»é‡ï¼Œé è¨­ 0

**å›å‚³ï¼š**
```json
{
  "table_name": "orders",
  "samples": [...],
  "limit": 50,
  "offset": 0,
  "count": 50
}
```

### ğŸ“Š åˆ†æçµæœæŸ¥è©¢å·¥å…·

#### `analysis_get_schema_analysis`
ç²å– Phase 1 çš„è³‡æ–™åº«æ¶æ§‹åˆ†æçµæœã€‚

**åƒæ•¸ï¼š**
- `query` (string, optional): æŸ¥è©¢é—œéµå­—
- `limit` (integer, optional): æœ€å¤§è¿”å›çµæœæ•¸ï¼Œé è¨­ 10

#### `analysis_get_business_logic`
ç²å– Phase 2 çš„æ¥­å‹™é‚è¼¯åˆ†æçµæœã€‚

**åƒæ•¸ï¼š**
- `query` (string, optional): æŸ¥è©¢é—œéµå­—
- `limit` (integer, optional): æœ€å¤§è¿”å›çµæœæ•¸ï¼Œé è¨­ 10

#### `analysis_get_business_overview`
ç²å– Phase 3 çš„ç¶œåˆæ¥­å‹™æ¦‚è¦½ã€‚

**åƒæ•¸ï¼š**
- `query` (string, optional): æŸ¥è©¢é—œéµå­—
- `limit` (integer, optional): æœ€å¤§è¿”å›çµæœæ•¸ï¼Œé è¨­ 10

#### `knowledge_get_statistics`
ç²å–çŸ¥è­˜åº«çµ±è¨ˆä¿¡æ¯ã€‚

**åƒæ•¸ï¼š** ç„¡

## LLM æŸ¥è©¢è³‡æ–™æµç¨‹

### 1. éœ€æ±‚åˆ†æéšæ®µ
LLM é¦–å…ˆåˆ†æç”¨æˆ¶çš„æŸ¥è©¢éœ€æ±‚ï¼Œç¢ºå®šéœ€è¦ä»€éº¼è³‡æ–™ã€‚

### 2. å·¥å…·é¸æ“‡éšæ®µ
æ ¹æ“šéœ€æ±‚é¸æ“‡åˆé©çš„ MCP å·¥å…·ï¼š

- **çµæ§‹æ¢ç´¢**: `database_get_table_schema`
- **è‡ªå®šç¾©æŸ¥è©¢**: `database_execute_sql_query`
- **æ¨£æœ¬æ•¸æ“š**: `database_get_table_samples`
- **åˆ†æçµæœ**: `analysis_*` ç³»åˆ—å·¥å…·

### 3. SQL ç”Ÿæˆéšæ®µ
LLM æ ¹æ“šæ¥­å‹™é‚è¼¯å’Œè¡¨çµæ§‹ç”Ÿæˆé©ç•¶çš„ SQL æŸ¥è©¢ã€‚

### 4. å·¥å…·èª¿ç”¨éšæ®µ
é€šé MCP å”è­°èª¿ç”¨å°æ‡‰çš„å·¥å…·ã€‚

### 5. çµæœåˆ†æéšæ®µ
æ¥æ”¶æŸ¥è©¢çµæœï¼Œé€²è¡Œæ¥­å‹™åˆ†æä¸¦ç”Ÿæˆæ´å¯Ÿã€‚

## å®‰å…¨ä¿éšœæªæ–½

### ğŸ”’ æŸ¥è©¢é™åˆ¶
- **åªè®€æ“ä½œ**: åªå…è¨± SELECT æŸ¥è©¢ï¼Œç¦æ­¢ INSERT/UPDATE/DELETE
- **è¡Œæ•¸é™åˆ¶**: é è¨­æœ€å¤šè¿”å› 100 è¡Œï¼Œå¯é…ç½®èª¿æ•´
- **æŸ¥è©¢é©—è­‰**: è‡ªå‹•æª¢æŸ¥ SQL èªæ³•å’Œå®‰å…¨æ€§

### ğŸ›¡ï¸ è³‡æ–™ä¿è­·
- **æ•æ„Ÿè³‡æ–™é®ç½©**: è‡ªå‹•è­˜åˆ¥ä¸¦é®ç½©æ•æ„Ÿæ¬„ä½
- **è¨ªå•æ§åˆ¶**: åŸºæ–¼è§’è‰²çš„è¨ªå•æ¬Šé™æ§åˆ¶
- **ç¨½æ ¸æ—¥èªŒ**: è¨˜éŒ„æ‰€æœ‰æŸ¥è©¢æ“ä½œ

### âš¡ æ•ˆèƒ½ä¿è­·
- **æŸ¥è©¢è¶…æ™‚**: é è¨­ 30 ç§’è¶…æ™‚é™åˆ¶
- **è³‡æºé™åˆ¶**: é™åˆ¶è¨˜æ†¶é«”å’Œ CPU ä½¿ç”¨
- **ä¸¦ç™¼æ§åˆ¶**: é˜²æ­¢éå¤šä¸¦ç™¼æŸ¥è©¢

## å¯¦éš›ä½¿ç”¨ç¯„ä¾‹

### ç¯„ä¾‹ 1: éŠ·å”®è¶¨å‹¢åˆ†æ

```
ç”¨æˆ¶æŸ¥è©¢ï¼šå¹«æˆ‘åˆ†æä¸€ä¸‹æœ€è¿‘ä¸€å€‹æœˆçš„éŠ·å”®è¶¨å‹¢

LLM åŸ·è¡Œæµç¨‹ï¼š
1. ä½¿ç”¨ database_get_table_schema äº†è§£ orders è¡¨çµæ§‹
2. ç”Ÿæˆ SQL æŸ¥è©¢ï¼š
   SELECT DATE_TRUNC('month', order_date) as month,
          SUM(total_amount) as total_sales,
          COUNT(*) as order_count
   FROM orders
   WHERE order_date >= CURRENT_DATE - INTERVAL '1 month'
   GROUP BY DATE_TRUNC('month', order_date)
   ORDER BY month DESC
3. èª¿ç”¨ database_execute_sql_query åŸ·è¡ŒæŸ¥è©¢
4. åˆ†æçµæœä¸¦ç”Ÿæˆæ¥­å‹™æ´å¯Ÿ
```

### ç¯„ä¾‹ 2: ç”¨æˆ¶è¡Œç‚ºåˆ†æ

```
ç”¨æˆ¶æŸ¥è©¢ï¼šå“ªäº›å•†å“æœ€å—å¹´è¼•ç”¨æˆ¶æ­¡è¿ï¼Ÿ

LLM åŸ·è¡Œæµç¨‹ï¼š
1. æ¢ç´¢ users å’Œ orders è¡¨çµæ§‹
2. ç”Ÿæˆè¤‡é›œæŸ¥è©¢ï¼š
   SELECT p.product_name,
          COUNT(o.id) as order_count,
          AVG(u.age) as avg_customer_age
   FROM products p
   JOIN orders o ON p.id = o.product_id
   JOIN users u ON o.user_id = u.id
   WHERE u.age BETWEEN 18 AND 35
   GROUP BY p.id, p.product_name
   ORDER BY order_count DESC
   LIMIT 10
3. åŸ·è¡ŒæŸ¥è©¢ä¸¦åˆ†æçµæœ
```

### ç¯„ä¾‹ 3: åº«å­˜ç®¡ç†åˆ†æ

```
ç”¨æˆ¶æŸ¥è©¢ï¼šå“ªäº›å•†å“éœ€è¦è£œè²¨ï¼Ÿ

LLM åŸ·è¡Œæµç¨‹ï¼š
1. æª¢æŸ¥ inventory å’Œ products è¡¨
2. åŸ·è¡ŒæŸ¥è©¢ï¼š
   SELECT p.product_name,
          i.current_stock,
          i.min_stock_level,
          i.current_stock - i.min_stock_level as shortage
   FROM products p
   JOIN inventory i ON p.id = i.product_id
   WHERE i.current_stock <= i.min_stock_level
   ORDER BY shortage ASC
3. ç”Ÿæˆè£œè²¨å»ºè­°
```

## æœ€ä½³å¯¦è¸

### 1. æŸ¥è©¢å„ªåŒ–
- ä½¿ç”¨é©ç•¶çš„ç´¢å¼•æ¬„ä½é€²è¡Œç¯©é¸
- é¿å…å…¨è¡¨æƒæ
- åˆç†ä½¿ç”¨ LIMIT é™åˆ¶çµæœé›†

### 2. æ¥­å‹™é‚è¼¯å„ªå…ˆ
- å…ˆç†è§£æ¥­å‹™éœ€æ±‚å†å¯«æŸ¥è©¢
- ä½¿ç”¨æœ‰æ„ç¾©çš„æ¬„ä½åç¨±å’Œåˆ¥å
- è€ƒæ…®è³‡æ–™çš„æ¥­å‹™å«ç¾©

### 3. éŒ¯èª¤è™•ç†
- æª¢æŸ¥æŸ¥è©¢çµæœæ˜¯å¦ç‚ºç©º
- è™•ç† NULL å€¼å’Œç•°å¸¸è³‡æ–™
- æä¾›æœ‰ç”¨çš„éŒ¯èª¤è¨Šæ¯

### 4. æ•ˆèƒ½è€ƒæ…®
- åˆ†æ‰¹è™•ç†å¤§é‡è³‡æ–™
- ä½¿ç”¨èšåˆå‡½æ•¸æ¸›å°‘è³‡æ–™å‚³è¼¸
- åˆç†è¨­ç½®æŸ¥è©¢è¶…æ™‚æ™‚é–“

## æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

**Q: æŸ¥è©¢è¿”å›ç©ºçµæœ**
A: æª¢æŸ¥è¡¨åæ‹¼å¯«ã€æ¬„ä½åç¨±ã€WHERE æ¢ä»¶æ˜¯å¦æ­£ç¢º

**Q: æŸ¥è©¢è¶…æ™‚**
A: å„ªåŒ–æŸ¥è©¢æ¢ä»¶ã€æ¸›å°‘è¿”å›è¡Œæ•¸ã€ä½¿ç”¨ç´¢å¼•

**Q: æ¬Šé™éŒ¯èª¤**
A: ç¢ºèªè³‡æ–™åº«é€£æ¥æ¬Šé™ï¼Œåªå…è¨± SELECT æ“ä½œ

**Q: è¨˜æ†¶é«”ä¸è¶³**
A: æ¸›å°‘æŸ¥è©¢ç¯„åœï¼Œä½¿ç”¨åˆ†é æŸ¥è©¢

## ç¸½çµ

MCP å·¥å…·ç‚º LLM æä¾›äº†å¼·å¤§çš„è³‡æ–™åº«æŸ¥è©¢èƒ½åŠ›ï¼Œçµåˆäº†å®‰å…¨æ€§ã€æ•ˆèƒ½å’Œæ˜“ç”¨æ€§ã€‚é€šéé€™äº›å·¥å…·ï¼ŒLLM å¯ä»¥ï¼š

- ğŸ” æ·±å…¥æ¢ç´¢è³‡æ–™åº«çµæ§‹
- ğŸ“Š åŸ·è¡Œè¤‡é›œçš„æ¥­å‹™åˆ†ææŸ¥è©¢
- ğŸ“ˆ ç”Ÿæˆæœ‰åƒ¹å€¼çš„æ¥­å‹™æ´å¯Ÿ
- ğŸ›¡ï¸ åœ¨å®‰å…¨å—æ§çš„ç’°å¢ƒä¸­æ“ä½œ

é€™ç¨®è¨­è¨ˆè®“ AI åŠ©æ‰‹èƒ½å¤ çœŸæ­£ç†è§£å’Œåˆ†ææ¥­å‹™è³‡æ–™ï¼Œç‚ºä½¿ç”¨è€…æä¾›æº–ç¢ºã€æœ‰ç”¨çš„åˆ†æçµæœã€‚</content>
<parameter name="filePath">/Users/masato/Dev/app/go/aika-dba/MCP_TOOLS_GUIDE.md